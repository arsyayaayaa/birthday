<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Birthday Climb â€” Baiq Ila Karunia (Chibi Girl)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#07111a; --accent:#ff6ec7; --soft:#ffe066; --white:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:'Press Start 2P',cursive; background:linear-gradient(#07111a,#021018); color:#fff; overflow:hidden}

  /* Landing overlay */
  #landing {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,.4));
    z-index:9999; transition:opacity .45s ease;
  }
  .landing-card{
    width:min(820px,92%); padding:26px; border-radius:12px; text-align:center;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:2px solid rgba(255,255,255,.04);
    box-shadow: 0 14px 60px rgba(0,0,0,.6);
  }
  #startBtn{
    margin-top:14px; padding:12px 18px; border-radius:10px; border:none; cursor:pointer;
    background:var(--soft); color:#111; font-weight:700;
  }

  /* HUD */
  #hud {
    position:fixed; left:18px; top:14px; z-index:60; text-shadow:0 2px 0 #000;
    background:rgba(0,0,0,.35); padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.04); display:none;
  }
  #hud .title{font-size:12px}
  #progress{font-size:11px; color:var(--soft); margin-top:6px}

  /* platform message box */
  #platformMessage {
    position:fixed; left:50%; top:14%; transform:translateX(-50%) translateY(-8px);
    background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.55));
    color:#fff; padding:10px 16px; border-radius:12px; font-size:12px;
    max-width:70vw; text-align:center; z-index:70; opacity:0; transition:opacity .35s, transform .35s;
    pointer-events:none;
  }

  /* game container */
  #gameWrap{position:relative; width:100%; height:100vh; display:flex; align-items:center; justify-content:center; z-index:1}
  canvas{ border-radius:10px; box-shadow:0 18px 80px rgba(0,0,0,.7); image-rendering:pixelated }

  /* ending overlay */
  #ending{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:999; padding:22px}
  .ending-card{
    width:min(980px,92vw); border-radius:16px; padding:20px; text-align:center;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:2px solid rgba(255,255,255,.06); backdrop-filter: blur(6px); box-shadow:0 30px 90px rgba(0,0,0,.6);
  }
  .photo-gallery{display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:12px}
  .photo-gallery img{width:160px; aspect-ratio:3/4; object-fit:cover; border-radius:12px; opacity:0; transform:translateY(12px) scale(.96); transition:opacity .8s ease, transform .8s ease;}

  .confetti,.balloons{position:fixed; inset:0; pointer-events:none; z-index:998}

  @media(max-width:900px){
    canvas{width:92vw;height:auto}
    .photo-gallery img{width:36vw}
  }
</style>
</head>
<body>

<!-- Landing -->
<div id="landing" role="dialog" aria-modal="true">
  <div class="landing-card">
    <div style="font-size:20px;color:var(--soft)">ðŸŽ‚ Baiq Ila Karunia â€” Climb Edition</div>
    <div style="margin-top:10px;color:#ddd;font-size:11px">Naik sampai puncak (24 tumpuan). Nikmati animasi & pesan ulang tahun di tiap tumpuan âœ¨</div>
    <button id="startBtn">Mulai Game</button>
  </div>
</div>

<!-- HUD -->
<div id="hud" aria-hidden="true">
  <div class="title">Naik sampai puncak!</div>
  <div id="progress">Tumpuan 1 / 24</div>
</div>

<!-- platform message -->
<div id="platformMessage" aria-live="polite"></div>

<!-- Game -->
<div id="gameWrap">
  <canvas id="gameCanvas" width="1366" height="768"></canvas>
</div>
<div class="confetti" id="confetti"></div>
<div class="balloons" id="balloons"></div>

<!-- Ending -->
<div id="ending" aria-hidden="true">
  <div class="ending-card" role="dialog" aria-modal="true">
    <div style="font-size:20px;color:var(--soft)">ðŸŽ‰ Selamat Ulang Tahun ðŸŽ‰</div>
    <div style="font-size:12px;color:#f2f2f2;margin-top:8px">Baiq Ila Karunia â€” semoga selalu diberi berkah, kebahagiaan, dan kejutan manis.</div>

    <div class="photo-gallery" id="gallery">
      <img src="IMG-20241121-WA0001.jpg" style="transition-delay:.2s">
      <img src="IMG-20241121-WA0000.jpg" style="transition-delay:.6s">
      <img src="IMG_20250726_100346.jpg" style="transition-delay:1s">
      <img src="IMG-20250324-WA0016.jpg" style="transition-delay:1.4s">
      <img src="IMG-20250503-WA0005.jpg" style="transition-delay:1.8s">
    </div>
  </div>
</div>

<!-- Audio -->
<audio id="endingAudio" src="Sal_Priadi_-_Serta_Mulia__Official_Lyric_Video_(128k).m4a" preload="auto"></audio>

<script>
/* ======================
   CONFIG & CANVAS
   ====================== */
const CANVAS_W = 1366, CANVAS_H = 768;
const PLATFORM_COUNT = 24;
const STEP_Y = 64;
const PLATFORM_MIN_W = 110, PLATFORM_MAX_W = 180;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = CANVAS_W; canvas.height = CANVAS_H;

/* ======================
   WORLD, PLATFORMS, GOAL
   ====================== */
const platforms = [];
(function genPlatforms(){
  const centerX = CANVAS_W/2;
  let prevX = centerX - 70;
  for(let i=0;i<PLATFORM_COUNT;i++){
    const jitter = (Math.random()-0.5) * 240 * 0.7;
    const w = Math.round(PLATFORM_MIN_W + Math.random()*(PLATFORM_MAX_W-PLATFORM_MIN_W));
    let x = prevX + jitter;
    x += (CANVAS_W/2 - x) * 0.08;
    x = Math.max(20, Math.min(CANVAS_W - w - 20, x));
    const y = 0 - i * STEP_Y; // world y (0 is start baseline)
    platforms.push({ x, y, w, h:18 });
    prevX = x;
  }
})();
const topP = platforms[platforms.length-1];
const goal = { x: topP.x + topP.w/2 - 16, y: topP.y - 86, w:32, h:72 };

/* ======================
   CAMERA & WORLD OFFSET
   ====================== */
let worldOffsetY = 0;
function worldToScreenY(worldY){
  return worldY - worldOffsetY + (CANVAS_H - 160);
}

/* ======================
   PLAYER (world coords) - chibi girl (drawn)
   ====================== */
const player = {
  x: platforms[0].x + platforms[0].w/2 - 14,
  y: platforms[0].y - 34,
  w:28, h:34,
  vx:0, vy:0, onGround:false,
  anim:0, state:'idle'
};

const GRAV = 0.72, MOVE = 1.1, JUMP = 13.6;

/* ======================
   MESSAGES (23) - ulang tahun
   ====================== */
const PLATFORM_MESSAGES = [
  "Hari ini spesial, sama seperti langkah pertamamu di sini âœ¨",
  "Satu pijakan lagi, satu harapan baru untukmu ðŸŽˆ",
  "Semoga setiap langkahmu ke depan membawamu pada hal-hal indah ðŸ’–",
  "Kamu bertambah dewasa, tapi hati baikmu tetap sama ðŸŒ·",
  "Langkah ini kecil, tapi maknanya besar. Sama seperti usiamu tahun ini ðŸŒŸ",
  "Hari ini kamu berhak merasa istimewaâ€¦ karena memang kamu istimewa ðŸŽ‚",
  "Semoga setiap tantangan baru membawa kamu lebih kuat âœ¨",
  "Tahun ini semoga jadi tahun yang penuh kejutan manis ðŸ°",
  "Kamu sudah sampai sejauh ini, dan aku bangga sekali ðŸ’•",
  "Setiap pijakan adalah doa baik untukmu di tahun yang baru ðŸŒ¼",
  "Semoga umurmu selalu berkah dan penuh keberanian ðŸŽ€",
  "Kamu tumbuh menjadi pribadi yang makin cantik luar dalam ðŸ’",
  "Semoga setiap hari ulang tahunmu membawa kebahagiaan baru ðŸ’›",
  "Jangan lupa tersenyumâ€¦ hari ini milikmu ðŸŽ‰",
  "Tahun baru usiamu membawa impian yang makin dekat ðŸŒ™",
  "Langkahmu manis, sama seperti kamu ðŸ“",
  "Semoga kamu selalu dikelilingi orang-orang baik dan tulus ðŸ’ž",
  "Apa yang kamu doakan, semoga perlahan mendekat padamu ðŸŒ»",
  "Kamu pantas merasa dicintai setiap hari ðŸ’—",
  "Semoga perjalanan hidupmu selalu dimudahkan ðŸš€",
  "Setiap langkahmu adalah harapan untuk masa depanmu ðŸŒˆ",
  "Tinggal sedikit lagi menuju kejutan ulang tahunmu ðŸŽ",
  "Sebelum sampai puncak, izinkan aku bilang: kamu hebat sekali ðŸ’“"
];

let lastPlatformShown = -1;
let lastTouchedPlatformIndex = -1;

/* ======================
   INPUT
   ====================== */
const keys = { left:false, right:false, up:false };
addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft' || e.key==='a') keys.left=true;
  if(e.key==='ArrowRight' || e.key==='d') keys.right=true;
  if(e.key==='ArrowUp' || e.key==='w' || e.key===' ') { keys.up=true; e.preventDefault(); }
});
addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft' || e.key==='a') keys.left=false;
  if(e.key==='ArrowRight' || e.key==='d') keys.right=false;
  if(e.key==='ArrowUp' || e.key==='w' || e.key===' ') keys.up=false;
});

/* ======================
   VISUAL EFFECTS: sparks
   ====================== */
const sparks = [];
function spawnSpark(screenX, screenY, n=10){
  for(let i=0;i<n;i++){
    sparks.push({
      x: screenX + (Math.random()-0.5)*24,
      y: screenY + (Math.random()-0.5)*8,
      vx: (Math.random()-0.5)*3,
      vy: -2 - Math.random()*2,
      life: 600 + Math.random()*700,
      t:0,
      c: ['#ffe066','#ff6ec7','#6ecbff','#ffffff'][Math.floor(Math.random()*4)]
    });
  }
}

/* ======================
   AUDIO
   ====================== */
const endingAudio = document.getElementById('endingAudio');
endingAudio.preload = 'auto';

/* ======================
   DRAW CHIBI (pixel-like)
   ====================== */
function drawChibi(sx, sy, state, anim){
  // sx,sy = screen coords (top-left)
  ctx.save();
  // slight drop shadow
  ctx.fillStyle = 'rgba(0,0,0,0.25)'; ctx.fillRect(sx+2, sy+4, player.w, player.h);
  // hair
  ctx.fillStyle = '#5b2a86'; ctx.fillRect(sx+6, sy+2, 16, 8);
  // face
  ctx.fillStyle = '#ffd8b6'; ctx.fillRect(sx+8, sy+8, 12, 10);
  // body
  ctx.fillStyle = '#ff6ec7'; ctx.fillRect(sx+6, sy+18, 16, 12);
  // eyes
  ctx.fillStyle = '#fff'; ctx.fillRect(sx+9, sy+10, 3,3); ctx.fillRect(sx+14, sy+10,3,3);
  ctx.fillStyle = '#000'; ctx.fillRect(sx+10, sy+11,1,1); ctx.fillRect(sx+15, sy+11,1,1);
  // simple walking legs animation
  const foot = Math.sin(anim*0.35)*3;
  ctx.fillStyle = '#5b2a86';
  ctx.fillRect(sx+8 + foot, sy+28, 5, 4);
  ctx.fillRect(sx+15 - foot, sy+28, 5, 4);
  ctx.restore();
}

/* ======================
   RENDER & UPDATE
   ====================== */
let running = false;
let last = performance.now();
function update(dt=16){
  // controls
  if(keys.left) player.vx -= MOVE;
  if(keys.right) player.vx += MOVE;
  if(keys.up && player.onGround){ player.vy = -JUMP; player.onGround = false; keys.up = false; }

  player.vy += GRAV;
  player.vx *= 0.88;
  player.x += player.vx;
  player.y += player.vy;

  // collisions (world coords)
  player.onGround = false;
  for(let i=0;i<platforms.length;i++){
    const p = platforms[i];
    // world coords: compare player bottom to platform y
    const pb = player.y + player.h;
    if(player.x + player.w > p.x && player.x < p.x + p.w){
      if(pb > p.y && pb < p.y + 18 && player.vy >= 0){
        // land
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;

        if(i > lastTouchedPlatformIndex){
          lastTouchedPlatformIndex = i;
          // spawn sparks at screen pos
          const sx = player.x + player.w/2;
          const sy = worldToScreenY(p.y);
          spawnSpark(sx, sy+2, 14);

          // show message (if available and not last puncak)
          if(i < PLATFORM_MESSAGES.length){
            showPlatformMessage(PLATFORM_MESSAGES[i]);
          }

          // update progress HUD text
          const progressEl = document.getElementById('progress');
          if(progressEl) progressEl.textContent = `Tumpuan ${i+1} / ${PLATFORM_COUNT}`;
        }
      }
    }
  }

  // bounds
  if(player.x < 8){ player.x = 8; player.vx = 0; }
  if(player.x + player.w > CANVAS_W - 8){ player.x = CANVAS_W - 8 - player.w; player.vx = 0; }

  // CAMERA follow using screen-player position logic (robust vertical follow)
  const screenPlayerY = worldToScreenY(player.y);
  if(screenPlayerY < CANVAS_H * 0.36){
    worldOffsetY -= (CANVAS_H * 0.36 - screenPlayerY) * 0.14;
  } else if(screenPlayerY > CANVAS_H * 0.68){
    worldOffsetY += (screenPlayerY - CANVAS_H * 0.68) * 0.08;
  }
  if(worldOffsetY < 0) worldOffsetY = 0;

  // reached goal?
  if(player.x + player.w > goal.x && player.x < goal.x + goal.w
     && player.y + player.h > goal.y && player.y < goal.y + goal.h){
    running = false;
    setTimeout(()=> showEnding(), 300);
  }

  // update sparks
  for(let i=sparks.length-1;i>=0;i--){
    const s = sparks[i];
    s.t += dt;
    s.x += s.vx; s.y += s.vy; s.vy += 0.06;
    if(s.t > s.life) sparks.splice(i,1);
  }

  // anim counters
  player.anim += (player.onGround && Math.abs(player.vx)>0.6) ? 1.8 : 0.6;
  player.state = player.onGround ? (Math.abs(player.vx)>0.8 ? 'walk' : 'idle') : 'jump';
}

function render(){
  ctx.clearRect(0,0,CANVAS_W,CANVAS_H);

  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,CANVAS_H*0.6);
  g.addColorStop(0,'#87CEEB'); g.addColorStop(1,'#6ecbff');
  ctx.fillStyle = g; ctx.fillRect(0,0,CANVAS_W,CANVAS_H*0.6);

  // parallax ground shapes
  ctx.save();
  ctx.fillStyle = '#10354a';
  ctx.beginPath(); ctx.ellipse(260, 360 + worldOffsetY*0.02, 340, 140, 0,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(980, 400 + worldOffsetY*0.025, 420, 160, 0,0,Math.PI*2); ctx.fill();
  ctx.restore();

  // draw platforms
  for(let i=0;i<platforms.length;i++){
    const p = platforms[i];
    const sx = p.x;
    const sy = worldToScreenY(p.y);
    // shadow
    ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.fillRect(sx-6, sy+6, p.w+12, p.h);
    // body
    const grad = ctx.createLinearGradient(sx, sy, sx, sy+p.h);
    const shades = ['#ffd8aa','#c6f1ff','#fff0a8','#c6ffd1','#ffdada','#d6eaff'];
    grad.addColorStop(0, shades[i%shades.length]); grad.addColorStop(1,'#ffffff33');
    ctx.fillStyle = grad; ctx.fillRect(sx, sy, p.w, p.h);
    ctx.strokeStyle = 'rgba(0,0,0,0.18)'; ctx.lineWidth = 1; ctx.strokeRect(sx, sy, p.w, p.h);
  }

  // draw goal flag
  const gx = goal.x, gy = worldToScreenY(goal.y);
  ctx.fillStyle = '#333'; ctx.fillRect(gx + goal.w/2 - 3, gy, 6, goal.h);
  ctx.fillStyle = '--'; // placeholder
  ctx.fillStyle = '#ff6ec7';
  ctx.beginPath(); ctx.moveTo(gx + goal.w/2 + 3, gy + 8); ctx.lineTo(gx + goal.w/2 + 64, gy + 22); ctx.lineTo(gx + goal.w/2 + 3, gy + 36); ctx.closePath(); ctx.fill();

  // draw sparks
  for(const s of sparks){
    ctx.globalAlpha = 1 - (s.t / s.life);
    ctx.fillStyle = s.c;
    ctx.fillRect(s.x, s.y, 4, 4);
    ctx.globalAlpha = 1;
  }

  // draw player (world->screen)
  const px = player.x;
  const py = worldToScreenY(player.y);
  drawChibi(px, py, player.state, player.anim);

  // done
}

/* ======================
   LOOP
   ====================== */
let lastTime = performance.now();
function loop(ts){
  if(!running) return;
  const dt = Math.min(40, ts - lastTime);
  lastTime = ts;
  update(dt);
  render();
  requestAnimationFrame(loop);
}

/* ======================
   UI: messages, ending, confetti
   ====================== */
const platformMessageEl = document.getElementById('platformMessage');
let platformMsgTimeout = null;
function showPlatformMessage(text){
  platformMessageEl.textContent = text;
  platformMessageEl.style.opacity = 1;
  platformMessageEl.style.transform = 'translateX(-50%) translateY(0)';
  if(platformMsgTimeout) clearTimeout(platformMsgTimeout);
  platformMsgTimeout = setTimeout(()=>{
    platformMessageEl.style.opacity = 0;
    platformMessageEl.style.transform = 'translateX(-50%) translateY(-8px)';
  }, 2600);
}

/* confetti / balloons */
const confettiWrap = document.getElementById('confetti');
const balloonsWrap = document.getElementById('balloons');
const endingEl = document.getElementById('ending');
const photoImgs = [...document.querySelectorAll('#gallery img')];

function confettiBurst(n=120){
  const colors = ['#ff6ec7','#6ecbff','#ffe066','#7CFF6E','#ffffff'];
  for(let i=0;i<n;i++){
    const el = document.createElement('span');
    el.style.position='absolute';
    el.style.left = (Math.random()*100)+'vw';
    el.style.top = (-10 - Math.random()*20)+'vh';
    el.style.width = (6 + Math.random()*8)+'px';
    el.style.height = (10 + Math.random()*10)+'px';
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.borderRadius = '2px';
    el.style.opacity = '0.95';
    el.style.transition = 'top 3.2s linear, transform 3.2s linear';
    confettiWrap.appendChild(el);
    setTimeout(()=>{ el.style.top = '110vh'; el.style.transform = `rotate(${Math.random()*720}deg)`; }, 20);
    setTimeout(()=> el.remove(), 3700);
  }
}
function floatBalloons(n=8){
  const colors = ['#ff6ec7','#6ecbff','#ffe066','#7CFF6E'];
  for(let i=0;i<n;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.width='36px'; el.style.height='46px';
    el.style.left = (5 + Math.random()*90)+'vw';
    el.style.bottom = '-20vh';
    el.style.borderRadius = '50% 50% 48% 52% / 60% 60% 40% 40%';
    el.style.background = colors[i%colors.length];
    balloonsWrap.appendChild(el);
    setTimeout(()=>{ el.style.transition = 'transform 10s linear, bottom 10s linear'; el.style.transform = `translateY(-120vh)`; el.style.bottom = '120vh'; }, 60);
    setTimeout(()=> el.remove(), 11500);
  }
}

function showEnding(){
  endingEl.style.display = 'flex';
  confettiBurst(180);
  floatBalloons(12);

  // reveal photos
  photoImgs.forEach((img,i)=>{
    setTimeout(()=>{ img.style.opacity = '1'; img.style.transform = 'translateY(0) scale(1)'; }, 240 + i*420);
  });

  // play audio 40-70s
  try{
    endingAudio.currentTime = 40;
    endingAudio.volume = 0.85;
    endingAudio.play().catch(()=>{/* blocked */});
    function checkTime(){ if(endingAudio.currentTime >= 70){ endingAudio.pause(); endingAudio.removeEventListener('timeupdate', checkTime); } }
    endingAudio.addEventListener('timeupdate', checkTime);
  }catch(e){ console.warn('audio err', e) }
}

/* ======================
   START BUTTON
   ====================== */
document.getElementById('startBtn').addEventListener('click', ()=>{
  // hide landing overlay
  const L = document.getElementById('landing');
  L.style.opacity = '0';
  setTimeout(()=> L.style.display = 'none', 450);

  // reset state
  lastPlatformShown = -1;
  lastTouchedPlatformIndex = -1;
  document.getElementById('progress').textContent = `Tumpuan 1 / ${PLATFORM_COUNT}`;
  document.getElementById('hud').style.display = 'block';

  // place player on bottom
  const bottom = platforms[0];
  player.x = bottom.x + bottom.w/2 - player.w/2;
  player.y = bottom.y - player.h - 2;
  player.vx = player.vy = 0;
  worldOffsetY = 0;

  running = true;
  lastTime = performance.now();
  requestAnimationFrame(loop);
});

/* small initial render */
render();
</script>
</body>
</html>
