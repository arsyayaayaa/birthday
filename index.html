<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Happy Birthday ‚Äî Baiq Ila Karunia (Climb Ladder)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#07111a; --pink:#ff6ec7; --yellow:#ffe066; --white:#fff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:'Press Start 2P',cursive; background:linear-gradient(#07111a,#021018); color:var(--white);
  overflow:hidden;
}

/* Landing */
#landing {
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,.35));
  z-index:9999;
}
.landing-card{
  padding:28px; border-radius:14px; text-align:center;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border:2px solid rgba(255,255,255,.04);
  width:min(820px,92%);
}
#startBtn{
  margin-top:14px; padding:12px 18px; border-radius:10px; border:none; cursor:pointer;
  background:var(--yellow); color:#111; font-family:'Press Start 2P';
}

/* HUD */
#hud{position:fixed; left:16px; top:12px; font-size:12px; opacity:.95; z-index:30; display:none;}
#hud .title{font-size:11px}

/* Game area */
#gameWrap{display:none; align-items:center; justify-content:center; height:100vh; position:relative; z-index:1;}
canvas{image-rendering:pixelated; background: linear-gradient(#87CEEB 60%, #55aa55 60%); border-radius:10px; border:4px solid #111; box-shadow:0 12px 40px rgba(0,0,0,.6);}
.btnTip{position:fixed; bottom:14px; left:50%; transform:translateX(-50%); font-size:11px; padding:8px 10px; border-radius:8px; background:rgba(0,0,0,.35); display:none; z-index:30}

/* Ending */
#ending{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:24px; z-index:999;}
.ending-card{
  width:min(980px,92vw); border-radius:18px; padding:22px; text-align:center;
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:2px solid rgba(255,255,255,.08); backdrop-filter: blur(6px);
  box-shadow:0 30px 90px rgba(0,0,0,.6);
}
.big-title{font-size:20px;color:var(--yellow); margin-bottom:6px}
.name{font-size:16px;color:var(--pink); margin-bottom:8px}
.photo-gallery{display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:12px}
.photo-gallery img{width:170px; aspect-ratio:3/4; object-fit:cover; border-radius:12px; opacity:0; transform:translateY(18px) scale(.94); animation:photoIn .9s forwards cubic-bezier(.17,.9,.28,1.15);}
@keyframes photoIn{ to{opacity:1; transform:translateY(0) scale(1);} }

/* confetti / balloons containers */
.confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:998}
.balloons{position:fixed; inset:0; pointer-events:none; z-index:997}

/* small responsive tweaks */
@media(max-width:720px){
  .photo-gallery img{width:36vw}
}
</style>
</head>
<body>

<!-- Landing -->
<div id="landing">
  <div class="landing-card">
    <div style="font-size:18px;color:var(--yellow)">üéÇ Baiq Ila Karunia ‚Äî Climb Edition</div>
    <div style="margin-top:8px;color:#ddd;font-size:11px">Naik sampai puncak (24 tumpuan) untuk melihat ucapan ulang tahunnya!</div>
    <button id="startBtn">Mulai Game</button>
  </div>
</div>

<!-- HUD -->
<div id="hud" aria-hidden="true">
  <div class="title">Naik sampai puncak!</div>
</div>

<!-- Game -->
<div id="gameWrap">
  <canvas id="gameCanvas" width="1366" height="768"></canvas>
  <!-- optional small message placeholder (not used for win condition) -->
  <div id="flagMessage" style="display:none;position:absolute;"></div>
</div>
<div class="btnTip">Controls: ‚Üê ‚Üí untuk bergerak ‚Ä¢ Spasi/‚Üë untuk lompat</div>

<!-- Ending -->
<div id="ending" role="dialog" aria-modal="true">
  <div class="ending-card">
    <div class="big-title">üéâ Selamat Ulang Tahun üéâ</div>
    <div class="name">Baiq Ila Karunia</div>
    <p style="max-width:760px;margin:8px auto 6px;color:#eef">Semoga selalu sehat, sukses, dan bahagia ya! üíñ</p>

    <div class="photo-gallery" id="gallery">
      <img src="IMG-20241121-WA0001.jpg" style="animation-delay:.20s">
      <img src="IMG-20241121-WA0000.jpg" style="animation-delay:.60s">
      <img src="IMG_20250726_100346.jpg" style="animation-delay:1.00s">
      <img src="IMG-20250324-WA0016.jpg" style="animation-delay:1.40s">
      <img src="IMG-20250503-WA0005.jpg" style="animation-delay:1.80s">
    </div>
  </div>

  <div class="confetti" id="confetti"></div>
  <div class="balloons" id="balloons"></div>
</div>

<!-- Audio (file must exist in repo root) -->
<audio id="endingAudio" src="Sal_Priadi_-_Serta_Mulia__Official_Lyric_Video_(128k).m4a" preload="auto"></audio>

<script>
/* ---------- Config ---------- */
const CANVAS_W = 1366, CANVAS_H = 768;
const PLATFORM_COUNT = 24;
const STEP_Y = 64; // vertical gap between platforms
const PLATFORM_MIN_W = 100, PLATFORM_MAX_W = 180;

/* ---------- Setup ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = CANVAS_W; canvas.height = CANVAS_H;

let running = false;
const keys = { left:false, right:false, up:false };

/* Player (world coordinates) */
const player = { x:0, y:0, w:28, h:34, vx:0, vy:0, onGround:false };

/* World / camera */
let worldOffsetY = 0; // how much world scrolled up (in px)
function worldToScreenY(worldY){
  // show player near bottom region: base + offset
  return worldY - worldOffsetY + (CANVAS_H - 160);
}

/* Generate ladder-style platforms (random-smooth) */
const platforms = [];
(function genPlatforms(){
  const centerX = CANVAS_W/2;
  let prevX = centerX - 70;
  // bottommost platform baseline (world y=0 for starting area)
  const bottomY = 0;
  for(let i=0;i<PLATFORM_COUNT;i++){
    // each platform higher than previous
    const idx = i;
    // smooth random: small jitter added to prevX, bias toward center
    const jitter = (Math.random() - 0.5) * 240 * (0.7); // reduce extremes
    let w = Math.round(PLATFORM_MIN_W + Math.random()*(PLATFORM_MAX_W-PLATFORM_MIN_W));
    let x = prevX + jitter;
    // bias toward center gradually
    x += (CANVAS_W/2 - x) * 0.08;
    x = Math.max(20, Math.min(CANVAS_W - w - 20, x));
    const y = bottomY - idx * STEP_Y; // upward negative world coords
    platforms.push({ x, y, w, h:18 });
    prevX = x;
  }
})();

/* goal sits above the topmost platform */
const topP = platforms[platforms.length - 1];
const goal = { x: topP.x + topP.w/2 - 16, y: topP.y - 86, w:32, h:72 };

/* physics */
const GRAV = 0.7, MOVE = 1.05, JUMP = 13.6;

/* input */
addEventListener('keydown', e=>{
  if(e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
  if(e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
  if(e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') { keys.up = true; e.preventDefault(); }
});
addEventListener('keyup', e=>{
  if(e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
  if(e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
  if(e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') keys.up = false;
});

/* helpers */
function aabb(ax,ay,aw,ah, bx,by,bw,bh){
  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
}

/* update */
function update(){
  // movement
  if(keys.left) player.vx -= MOVE;
  if(keys.right) player.vx += MOVE;
  // jump only if on ground
  if(keys.up && player.onGround){
    player.vy = -JUMP; player.onGround = false; keys.up = false;
  }

  player.vy += GRAV;
  player.vx *= 0.88;
  player.x += player.vx;
  player.y += player.vy;

  // platform collision in world coords
  player.onGround = false;
  for(const p of platforms){
    if(aabb(player.x, player.y, player.w, player.h, p.x, p.y - 6, p.w, p.h + 8)){
      if(player.vy > 0 && (player.y + player.h - player.vy) <= (p.y + p.h + 6)){
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;
      }
    }
  }

  // keep player within horizontal bounds
  if(player.x < 8) { player.x = 8; player.vx = 0; }
  if(player.x + player.w > CANVAS_W - 8) { player.x = CANVAS_W - 8 - player.w; player.vx = 0; }

  // camera follow upward: move worldOffsetY so player tends to stay near 35% from top when climbing
  const playerScreenY = worldToScreenY(player.y);
  if(playerScreenY < CANVAS_H * 0.35){
    worldOffsetY -= (CANVAS_H * 0.35 - playerScreenY) * 0.14;
  } else if(playerScreenY > CANVAS_H * 0.75) {
    worldOffsetY += (playerScreenY - CANVAS_H * 0.75) * 0.06;
  }
  worldOffsetY = Math.max(0, worldOffsetY);

  // if player falls too far below bottommost platform, reset near start
  const bottom = platforms[0];
  if(player.y > bottom.y + 420){
    player.x = bottom.x + bottom.w/2 - player.w/2;
    player.y = bottom.y - player.h - 6;
    player.vx = player.vy = 0;
    worldOffsetY = 0;
  }

  // check goal (world coords)
  if(aabb(player.x, player.y, player.w, player.h, goal.x, goal.y, goal.w, goal.h)){
    // reached top -> show ending
    running = false;
    setTimeout(showEnding, 300);
  }
}

/* render */
function render(){
  // clear
  ctx.clearRect(0,0, CANVAS_W, CANVAS_H);

  // sky stripe / decorative
  ctx.fillStyle = '#87CEEB';
  ctx.fillRect(0, 0, CANVAS_W, CANVAS_H * 0.6);

  // draw platforms
  for(const p of platforms){
    const sx = p.x;
    const sy = worldToScreenY(p.y);
    // drop shadow
    ctx.fillStyle = 'rgba(0,0,0,0.35)';
    ctx.fillRect(sx - 6, sy + 6, p.w + 12, p.h);
    // platform
    ctx.fillStyle = p.color || '#ffd8aa';
    ctx.fillRect(sx, sy, p.w, p.h);
  }

  // draw goal flag (world->screen)
  const gx = goal.x, gy = worldToScreenY(goal.y);
  // pole
  ctx.fillStyle = '#333';
  ctx.fillRect(gx + goal.w/2 - 3, gy, 6, goal.h);
  // flag cloth
  ctx.fillStyle = '#ff6ec7';
  ctx.beginPath();
  ctx.moveTo(gx + goal.w/2 + 3, gy + 8);
  ctx.lineTo(gx + goal.w/2 + 64, gy + 22);
  ctx.lineTo(gx + goal.w/2 + 3, gy + 36);
  ctx.closePath();
  ctx.fill();

  // draw player
  const px = player.x, py = worldToScreenY(player.y);
  ctx.fillStyle = '#ff4d4d';
  ctx.fillRect(px, py, player.w, player.h);
  // eyes
  ctx.fillStyle = '#fff';
  ctx.fillRect(px + 6, py + 8, 6, 6);
  ctx.fillRect(px + 16, py + 8, 6, 6);

  // HUD text drawing (redundant with DOM HUD)
  ctx.fillStyle = '#000';
  ctx.font = "12px 'Press Start 2P'";
  ctx.fillText("Naik sampai puncak!", 18, 22);
}

/* loop */
function loop(){
  if(!running) return;
  update(); render();
  requestAnimationFrame(loop);
}

/* ---------- Ending & Visuals ---------- */
const endingEl = document.getElementById('ending');
const confettiWrap = document.getElementById('confetti');
const balloonsWrap = document.getElementById('balloons');
const photoImgs = [...document.querySelectorAll('#gallery img')];
const endingAudio = document.getElementById('endingAudio');

function showEnding(){
  // hide game UI
  document.getElementById('gameWrap').style.display = 'none';
  document.querySelector('.btnTip').style.display = 'none';
  document.getElementById('hud').style.display = 'none';

  // show ending card
  endingEl.style.display = 'flex';
  // spawn confetti & balloons
  confettiBurst(140);
  floatBalloons(8);

  // play audio from 40s to 70s
  try{
    endingAudio.currentTime = 40;
    endingAudio.volume = 0.85;
    endingAudio.play().catch(()=>{ /* if blocked */ });
    const stopAt = 70;
    function checkTime(){ if(endingAudio.currentTime >= stopAt){ endingAudio.pause(); endingAudio.removeEventListener('timeupdate', checkTime); } }
    endingAudio.addEventListener('timeupdate', checkTime);
  }catch(e){ console.log('audio err', e); }

  // reveal photos one by one
  photoImgs.forEach((img, i)=>{
    setTimeout(()=> img.style.opacity = '1', 240 + i * 520);
  });
}

/* confetti */
function confettiBurst(n=100){
  const colors = ['#ff6ec7','#6ecbff','#ffe066','#7CFF6E','#ffffff'];
  for(let i=0;i<n;i++){
    const el = document.createElement('span');
    el.style.position = 'absolute';
    el.style.width = (6 + Math.random()*8) + 'px';
    el.style.height = (10 + Math.random()*10) + 'px';
    el.style.left = (Math.random()*100) + 'vw';
    el.style.top = (-10 - Math.random()*20) + 'vh';
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.borderRadius = '2px';
    el.style.opacity = '0.95';
    el.style.transform = `rotate(${Math.random()*360}deg)`;
    el.style.transition = 'transform 3s linear, top 3s linear';
    confettiWrap.appendChild(el);
    setTimeout(()=>{ el.style.top = '110vh'; el.style.transform = `rotate(${Math.random()*720}deg)`; }, 20);
    setTimeout(()=> el.remove(), 3500 + Math.random()*1500);
  }
}

/* balloons */
function floatBalloons(n=6){
  const colors = ['#ff6ec7','#6ecbff','#ffe066','#7CFF6E'];
  for(let i=0;i<n;i++){
    const el = document.createElement('div');
    el.style.position = 'absolute';
    el.style.width = '36px';
    el.style.height = '46px';
    el.style.left = (5 + Math.random()*90) + 'vw';
    el.style.bottom = '-20vh';
    el.style.borderRadius = '50% 50% 48% 52% / 60% 60% 40% 40%';
    el.style.background = colors[i % colors.length];
    el.style.opacity = '0.95';
    balloonsWrap.appendChild(el);
    setTimeout(()=>{ el.style.transition = 'transform 10s linear, bottom 10s linear'; el.style.transform = `translateY(-120vh)`; el.style.bottom = '120vh'; }, 40);
    setTimeout(()=> el.remove(), 11500);
  }
}

/* ---------- Start (Landing) ---------- */
document.getElementById('startBtn').addEventListener('click', ()=>{
  // hide landing, show game UI
  document.getElementById('landing').style.display = 'none';
  document.getElementById('gameWrap').style.display = 'flex';
  document.querySelector('.btnTip').style.display = 'block';
  document.getElementById('hud').style.display = 'block';

  // position player on bottom-most platform
  const bottom = platforms[0];
  player.x = bottom.x + bottom.w/2 - player.w/2;
  player.y = bottom.y - player.h - 6;
  player.vx = player.vy = 0;
  worldOffsetY = 0;

  // apply color shades for platforms
  for(let i=0;i<platforms.length;i++){
    platforms[i].color = ['#ffd8aa','#c6f1ff','#fff0a8','#c6ffd1','#ffdada','#d6eaff'][i % 6];
  }

  running = true;
  loop();

  // small safety: resume audio context in some mobile browsers (not required here but helpful)
  try{ if(window.AudioContext && !window.audioCtxResumed){ const ac = new (window.AudioContext || window.webkitAudioContext)(); ac.resume(); window.audioCtxResumed = true; } }catch(e){}
});

/* initial render */
render();
</script>

</body>
</html>
